{% extends "base.html" %} {% block title %}Badger+ Chat{% endblock title %} {%
block content %}
<div class="header">
  <div class="chat-title">Chat with Badger+</div>
  <div class="info-title">Your Daily Info</div>
</div>
<div class="container">
  <div class="chat-container">
    <div class="chat-messages">
      <!-- Chat messages will be displayed here -->
    </div>
    <div class="chat-input">
      <input type="text" id="messageInput" placeholder="Type your message..." />
      <button id="sendButton">Send</button>
    </div>
  </div>
  <div class="info-container">
    <h2>Student Dashboard</h2>
    <div class="info-section">
      <h3>Upcoming Assignments</h3>
      <ul>
        <li>Math: Algebra II Homework - Due Tomorrow</li>
        <li>Science: Chemistry Lab Report - Due Friday</li>
        <li>History: Civil War Essay - Due Next Monday</li>
      </ul>
    </div>
    <div class="info-section">
      <h3>Clubs of Interest</h3>
      <ul>
        <li>Robotics Club - Meeting Thursday 5pm</li>
        <li>Debate Team - New Member Orientation Wednesday</li>
        <li>Chess Club - Tournament Sign-ups Open</li>
      </ul>
    </div>
    <div class="info-section">
      <h3>Recommended Restaurants</h3>
      <ul>
        <li>Pizza World - Best for Group Studies</li>
        <li>The Green Bowl - Healthy and Quick</li>
        <li>Book & Brew - Quiet Place to Read</li>
      </ul>
    </div>
  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const sendButton = document.getElementById("sendButton");
    const messageInput = document.getElementById("messageInput");
    const chatMessages = document.querySelector(".chat-messages");

    function appendMessage(text, className) {
      const messageElement = document.createElement("div");
      messageElement.textContent = text;
      messageElement.classList.add(className); // Use provided class for styling
      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to the bottom
    }

    function sendMessage() {
      const message = messageInput.value.trim();
      if (message) {
        appendMessage(message, "user-message"); // Display user message
        messageInput.value = ""; // Clear input field

        // Append typing indicator
        const typingIndicator = document.createElement("div");
        typingIndicator.classList.add("typing-indicator");
        for (let i = 0; i < 3; i++) {
          // Create 3 dots
          const dot = document.createElement("span");
          typingIndicator.appendChild(dot);
        }
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom

        // Send the user's message to the Flask backend
        fetch("/get_chat_response", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            user_input: message,
            username: sessionStorage.getItem("username"), // Send username with the request
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            chatMessages.removeChild(typingIndicator); // Remove typing indicator
            appendMessage(data.response, "bot-message"); // Display the chatbot's response
          })
          .catch((error) => {
            console.error("Error:", error);
            chatMessages.removeChild(typingIndicator); // Ensure to remove typing indicator even on error
            appendMessage("Sorry, something went wrong.", "bot-message");
          });
      }
    }

    sendButton.addEventListener("click", sendMessage);
    messageInput.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        sendMessage();
        e.preventDefault(); // Prevent form submission or line break
      }
    });
  });
</script>

{% endblock content %}
